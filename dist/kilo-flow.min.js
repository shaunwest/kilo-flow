var kilo=function(t){"use strict";function n(t){var n;"complete"===document.readyState?t(document):n=setInterval(function(){"complete"===document.readyState&&(t(document),clearInterval(n))},10)}function e(t,n,e){var r,o,i;for(r=0,o=n.length;o>r;r++)i=n[r],i.hasAttribute("data-"+t)&&(a[t]||(a[t]=[]),a[t].push(i),e(i))}function r(t,n,r,o,i){e(t,n,function(t){r?o.apply(t,u.resolve(r)):o.call(t,i)})}var o,i,u,s={},c={},a={},l=void 0,f=t;return i={isDefined:function(t){return"undefined"!=typeof t},isBoolean:function(t){return"boolean"==typeof t},def:function(t,n){return"undefined"==typeof t?n:t},error:function(t){throw new Error(f+": "+t)},warn:function(t){i.log("Warning: "+t)},log:function(t){o.log&&console.log(f+": "+t)},argsToArray:function(t){return Array.prototype.slice.call(t)},getGID:function(t){return t=i.def(t,""),c[t]=i.def(c[t],0),t+ ++c[t]},rand:function(t,n){return n=n||0,(n>t||n>t)&&i.error("rand: invalid range."),Math.floor(Math.random()*(t-n+1))+n}},["Array","Object","Arguments","Function","String","Number","Date","RegExp","HTMLImageElement"].forEach(function(t){i["is"+t]=function(n){return Object.prototype.toString.call(n)==="[object "+t+"]"}}),u={unresolved:{},modules:{},register:function(t,n,e,r){return this.unresolved[t]={deps:n,func:e,scope:r},this},unresolve:function(t){this.modules[t]&&delete this.modules[t]},setModule:function(t,n){return this.modules[t]=n,this},getDependency:function(t){var n=this.modules[t];return n?n:(n=this.unresolved[t])?(i.log("Resolving dependencies for '"+t+"'"),n=this.modules[t]=this.resolveAndApply(n.deps,n.func,n.scope),i.isObject(n)&&(n.getType=function(){return t}),n):(i.warn("Module '"+t+"' not found"),null)},resolve:function(t){var n,e,r,o=[];for(r=0;r<t.length;r++)e=t[r],n=this.getDependency(e),n?o.push(n):i.warn("Can't resolve "+e);return o},apply:function(t,n,e){return n.apply(e||o,t)},resolveAndApply:function(t,n,e){return this.apply(this.resolve(t),n,e)}},u.setModule("helper",i).setModule("Helper",i).setModule("Util",i).setModule("injector",u).setModule("Injector",u).setModule("appConfig",s),o=function(t,n,e,r){var o;if(i.isArray(t))o=u.resolveAndApply(t,n,e),i.isObject(o)&&Object.keys(o).forEach(function(t){u.setModule(t,o[t])});else if(i.isArray(n)&&i.isFunction(e))u.register(t,n,e,r);else if(i.isFunction(n))u.register(t,[],n,e);else if(t&&!i.isDefined(n))return u.getDependency(t);return null},o.unresolve=function(t){u.unresolve(t)},o.noConflict=function(){return window[t]=l,o},o.element=function(t,e,o){var u,s;return i.isFunction(e)?o=e:i.isArray(e)?u=e:i.error("element: second argument should be function or dependency array."),n(function(n){var e;if(!s){if(e=n.getElementsByTagName("body"),!e||!e[0])return;s=e[0].querySelectorAll("*")}r(t,s,u,o)}),this},o.childElement=function(t,e,o,u){var s;return i.isFunction(o)?u=o:i.isArray(o)?s=o:i.error("element: second argument should be function or dependency array."),n(function(){var n,o,i,c,l=a[t];for(n=0,i=l.length;i>n;n++)c=l[n],o=c.querySelectorAll("*"),r(e,o,s,u,c)}),this},o.onDocumentReady=o.ready=n,o.log=!0,window[t]&&(i.warn("a preexisting value at namespace '"+t+"' has been overwritten."),l=window[t]),window[t]=o,o}("kilo");kilo("Canvas",[],function(){"use strict";return{clearContext:function(t,n,e){t.clearRect(0,0,n,e)},drawBackground:function(t,n,e,r,o,i){t.fillStyle=i||"red",t.fillRect(r||0,o||0,n,e)},drawBorder:function(t,n,e,r,o,i){t.beginPath(),t.strokeStyle=i||"black",t.rect(r||0,o||0,n,e),t.stroke(),t.closePath()}}}),kilo("Extend",["Obj"],function(t){"use strict";return t.extend.bind(t)}),kilo("Factory",["Obj","Pool"],function(t){"use strict";return function(n){var e=t.mixin([n]);return e}}),kilo("Func",[],function(){"use strict";function t(t){var n=Array.prototype.slice.call(arguments,1);return function(){for(var e=n.slice(),r=0;r<arguments.length;r++)e.push(arguments[r]);return t.apply(this,e)}}function n(n,e){return t(e,n)}function e(t){return function(){var n=Array.prototype.slice.call(arguments),e=n.length;return function(r){return n[e]=r,t.apply(this,n)}}}return{partial:t,fastPartial:e,wrap:n}}),kilo("HashArray",[],function(){"use strict";function t(){this.values=[],this.keyMap={}}function n(t,n){var e;for(e in t)t.hasOwnProperty(e)&&t[e]>n&&t[e]--}function e(t,n){var e;for(e in t)t.hasOwnProperty(e)&&t[e]>=n&&t[e]++}return t.prototype.set=function(t,n){return this.keyMap[t]?(this.values[this.keyMap[t]]=n,!0):(this.values.push(n),this.keyMap[t]=this.values.length-1,!1)},t.prototype.splice=function(t,n,r){var o=this.keyMap[t]+1;this.values.splice(o,0,r),e(this.keyMap,o),this.keyMap[n]=o},t.prototype.get=function(t){return this.values[this.keyMap[t]]},t.prototype.remove=function(t){var e=this.keyMap[t];this.values.splice(e,1),n(this.keyMap,e),delete this.keyMap[t]},t.prototype.removeAll=function(){var t,n=this.keyMap;this.values.length=0;for(t in n)delete n[t]},t.prototype.getIdByIndex=function(t){var n,e=this.keyMap;for(n in e)if(e[n]===t)return n;return""},t.prototype.getKeys=function(){var t,n=this.size(),e=[];for(t=0;n>t;t++)e.push(this.getIdByIndex(t));return e},t.prototype.getValues=function(){return this.values},t.prototype.size=function(){return this.values.length},t}),kilo("KeyStore",["HashArray","Util"],function(t,n){"use strict";function e(){this.lastId=0,this.store=new t}return e.prototype.get=function(t){return this.store.get(t)},e.prototype.set=function(t,e){var r;return n.isDefined(e)?r=t||this.lastId++:(r=this.lastId++,e=t),this.store.add(r,e),r},e.prototype.setGroup=function(t,e){var r,o;return n.isDefined(e)?(r=t,n.isDefined(r)?o=this.get(r):(r=this.lastId++,o=[],this.store.add(r,o))):(r=this.lastId++,e=t,o=[],this.store.add(r,o)),o?o.push(e):console.error("Jack2d: keyStore: id '"+r+"' not found."),r},e.prototype.clear=function(t){n.isDefined(t)?this.store.remove(t):this.store.removeAll()},e.prototype.getItems=function(){return this.store.items},e}),kilo("Mixin",["Obj"],function(t){"use strict";return t.mixin.bind(t)}),kilo("Obj",["Injector","Util","Func","Pool"],function(t,n,e,r){"use strict";function o(t,r,o,i){return t=t||{},t.__mixin===!1?void n.error("Can't mixin object because the object has disallowed it."):void Object.keys(t).forEach(function(u){r.hasOwnProperty(u)?o?(r[u]=e.wrap(r[u],t[u]),n.log("Mixin: wrapped '"+u+"'")):i?n.error("Failed to merge mixin. Method '"+u+"' caused a name collision."):(r[u]=t[u],n.log("Mixin: overwrote '"+u+"'")):r[u]=t[u]})}function i(t,e){var r={};return Object.keys(t).forEach(function(o){n.isFunction(t[o])&&(r[o]=u(t[o],t,e))}),r}function u(t,e,r){return function(){var o=n.argsToArray(arguments);return r?(o.unshift(t),r.apply(e,o)):t.apply(e,o)}}return{replaceMethod:function(t,n,e,r){Object.keys(t).forEach(function(o){t[o]===n&&(console.log(r),t[o]=e)})},augment:function(t,n){return i(t,n)},clone:function(t){return this.merge(t)},merge:function(t,n){var e;n=n||{};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n},create:function(t){return this.mixin(t)},print:function(t){var e,r="";for(e in t)t.hasOwnProperty(e)&&!n.isFunction(t[e])&&(r+=e+": "+t[e]+"<br>");return r},clear:function(t){var n;for(n in t)t.hasOwnProperty(n)&&delete t[n];return t},extend:function(){var t=arguments.length>1?n.argsToArray(arguments):arguments[0];return this.mixin(t,!0)},mixin:function(e,i,u){var s=r.getObject();return n.isArray(e)?e.forEach(function(e){n.isString(e)&&(e=t.getDependency(e)),o(e,s,i,u)}):(n.isString(e)&&(e=t.getDependency(e)),o(e,s,i,u)),s}}}),kilo("Pool",[],function(){"use strict";function t(){var t=o.pop();return t||(t={}),t}function n(t){var n;for(n in t)t.hasOwnProperty(n)&&delete t[n];return t}function e(t){o.push(n(t))}function r(){return o.length}var o=[];return{getObject:t,killObject:e,available:r}}),kilo("rect",[],function(){"use strict";function t(t,n,e){return!(t<e.left||t>e.right||n<e.top||n>e.bottom)}function n(t,n){return!(t.left<n.left||t.right>n.right||t.top<n.top||t.bottom>n.bottom)}function e(t,n){var e=!(t.left<n.left||t.right>n.right);return e?!1:t.left-n.left}function r(t,n){return!(t<n.left||t>n.right)}function o(t,n){var e=!(t.top<n.top||t.bottom>n.bottom);return e?!1:t.top-n.top}function i(t,n){return!(t<n.top||t>n.bottom)}function u(t,n){var e=!(n.left>=t.right||n.right<=t.left);return e?t.left-n.left:!1}function s(t,n){var e=!(n.top>=t.bottom||n.bottom<=t.top);return e?t.top-n.top:!1}return{setLeft:function(t){return this.left=t,this},setTop:function(t){return this.top=t,this},setRight:function(t){return this.right=t,this},setBottom:function(t){return this.bottom=t,this},containsPoint:t,containsRect:n,containsX:r,containsY:i,containsRectX:e,containsRectY:o,intersectsRectX:u,intersectsRectY:s}}),function(){for(var t=0,n=["ms","moz","webkit","o"],e=0;e<n.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"]||window[n[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var e=(new Date).getTime(),r=Math.max(0,16-(e-t)),o=window.setTimeout(function(){n(e+r)},r);return t=e+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),kilo("SchedulerObject",["Util","Scheduler","Func"],function(t,n,e){"use strict";return{onFrame:function(e,r){var o=t.getGID(r);return this.chronoIds||(this.chronoIds=[]),this.hooks||(this.hooks={}),e=e.bind(this),r&&(this.hooks[r]=o),this.chronoIds.push(n.register(e,o)),this},getChronoId:function(t){return this.hooks?this.hooks[t]:null},hook:function(t,r){var o,i=this.getChronoId(t);i&&(o=n.getRegistered(i),o=e.wrap(o,r),n.register(o,i))},killOnFrame:function(t){return t?n.unRegister(t):this.chronoIds&&this.chronoIds.forEach(function(t){n.unRegister(t)}),this}}}),kilo("Scheduler",["HashArray","Util"],function(t,n){"use strict";function e(){return r(),l(),R}function r(){return w=60,b=0,k=0,F=0,A=0,O=0,P=new t,x=!1,M=new Date,R}function o(t,e){return n.isFunction(t)||n.error("Scheduler: only functions can be registered."),e||(e=n.getGID(e)),P.set(e,t),e}function i(t,n,e){return e||(e=A++),P.splice(t,e,n),e}function u(t){return P.remove(t),R}function s(t){return t?P.get(t):P.getValues()}function c(){j=window.requestAnimationFrame(h)}function a(){return P.size()}function l(){return x||(x=!0,I=window.setInterval(m,C),h()),R}function f(){return x=!1,window.clearInterval(I),window.cancelAnimationFrame(j),R}function h(){p(d()),g(),x&&c()}function p(t){var n,e,r,o;for(n=P.getValues(),e=n.length,o=0;e>o;o++)r=n[o],r&&r(t)}function d(){var t=+new Date,n=(t-M)/C;return M=t,n}function g(){k++}function m(){b=k.toString(),k=0,F++}function y(){return b}function v(){return F}var w,b,k,x,F,P,A,O,I,j,M,R,C=1e3;return e(),R={__mixin:!1,init:e,reset:r,start:l,stop:f,register:o,registerAfter:i,unRegister:u,getRegistered:s,registeredCount:a,getFps:y,getSeconds:v}}),kilo("CommandObject",["Util"],function(t){"use strict";function n(t,n){return t.commandRunner.add(n),t}function e(){return n(this,{done:!0})}function r(t){var e=Array.prototype.slice.call(arguments,1);return n(this,{func:t,sourceAsArg:!0,args:e,context:this})}function o(t){return n(this,{watchProp:t,lastValue:null,logicals:[],specials:[]})}function i(t,n){return this.when(t,n,!0)}function u(){return n(this,{endGroup:!0})}function s(e,r,o){return n(this,{whenProp:e,whenValue:r,isFunc:t.isFunction(r),logicals:[],specials:[],commands:[],group:o})}function c(t){return this.when(t,!1)}function a(e,r){return n(this,{isLogical:!0,logicalProp:e,logicalValue:r,logicalType:"and",isFunc:t.isFunction(r),specials:[]})}function l(e,r){return n(this,{isLogical:!0,logicalProp:e,logicalValue:r,logicalType:"or",isFunc:t.isFunction(r),specials:[]})}function f(t,e,r,o){return n(this,{setProp:t,setValue:e,inc:r,format:o})}function h(t,n,e){return this.set(t,n,!0,e)}function p(t){return n(this,{eventName:t})}function d(t){var e=Array.prototype.slice.call(arguments,1);return n(this,{func:t,args:e})}function g(){return this.commandRunner.context}return{commandRunner:null,logicMode:"",done:e,get:r,watch:o,whenGroup:i,endGroup:u,when:s,whenNot:c,andWhen:a,orWhen:l,set:f,inc:h,on:p,call:d,source:g}}),kilo("CommandRunner",["Util","Scheduler"],function(t,n){"use strict";function e(t,n){function e(t,n){return t?2===n.length?t[n[0]]:e(t[n[0]],n.slice(1)):t}var r=n.split(".");return 1===r.length?t:e(t,r)}function r(t){return t.split(".").slice(-1)[0]}function o(t,n){this.chronoId=n,this.context=t,this.conditional=null,this.specialQueue=null}return o.prototype.add=function(t){t.setProp&&(t.context=e(this.context,t.setProp),t.setProp=r(t.setProp)),this.evaluateCommand(t)},o.prototype.evaluateCommand=function(t){if(t.whenProp||t.watchProp)this.specialQueue||(this.specialQueue=this.repeatQueue()),this.specialQueue.push(t);else if(t.eventName)this.specialQueue=this.eventQueue(t);else if(t.done)this.specialQueue=null;else{if(!this.specialQueue)return this.executeCommand(t);this.specialQueue.push(t)}return null},o.prototype.repeatQueue=function(){var e=[];return this.chronoId?n.registerAfter(this.chronoId,function(){this.processRepeatCommands(e)}.bind(this),t.getGID("command-repeat")):n.register(function(){this.processRepeatCommands(e)}.bind(this),t.getGID("command-repeat")),e},o.prototype.eventQueue=function(t){var n=[],e=this.context,r=this;return e.addEventListener&&e.addEventListener(t.eventName,function(){var t,e=n.length;for(t=0;e>t;t++)r.executeCommand(n[t])}),n},o.prototype.processRepeatCommands=function(t){var n,e,r=null,o=null,i=0;for(n=t.length;n>i;)e=t.shift(),e.group?o=e:e.endGroup?o=null:e.whenProp||e.watchProp?(r=e,r.logicals.length=0):r&&e.isLogical?r.logicals.push(e):o?this.evaluateConditional(o)&&r&&this.evaluateConditional(r)&&this.executeCommand(e):r&&this.evaluateConditional(r)&&this.executeCommand(e),t.push(e),i++},o.prototype.checkWatch=function(t){var n=this.context;return n[t.watchProp]!==t.lastValue?(t.lastValue=n[t.watchProp],!0):!1},o.prototype.evaluateConditional=function(n){var e=this.context;return n.isFunc&&n.whenValue.call(e,e[n.whenProp])||n.watchProp&&this.checkWatch(n,e)||n.whenProp&&t.isDefined(n.whenValue)&&e[n.whenProp]===n.whenValue||n.whenProp&&!t.isDefined(n.whenValue)&&t.isDefined(e[n.whenProp])?n.logicals.length>0?this.evaluateLogical(n.logicals,n.whenProp||n.watchProp,!0):!0:n.logicals.length>0?this.evaluateLogical(n.logicals,n.whenProp||n.watchProp,!1):!1},o.prototype.evaluateLogical=function(n,e,r){var o,i,u,s,c=this.context;for(s=0,o=n.length;o>s;s++)if(i=n[s],u=i.logicalType,e=i.logicalProp||e,i.isFunc)if(i.logicalValue.call(c,c[e])){if("or"===u)return!0}else"and"===u&&(r=!1);else if(t.isDefined(c[e])){if("or"===u)return!0}else"and"===u&&(r=!1);return r},o.prototype.executeCommand=function(t){var n,e,r,o=this.context;return t.complete?0===this.commandQueue.length?t.func.apply(t):n=t:t.eventName?o.addEventListener&&o.addEventListener(t.eventName,t.func):t.func?(t.sourceAsArg&&t.args.unshift(o),t.func.apply(t.context||o,t.args)):t.setProp&&(e=t.setProp,t.inc?"px"===t.format?t.context[e]?(r=t.context[e],t.context[e]=parseInt(r)+t.setValue+"px"):t.context[e]=t.setValue+"px":"%"===t.format?t.context[e]?(r=t.context[e],t.context[e]=parseInt(r)+t.setValue+"%"):t.context[e]=t.setValue+"%":(t.context[e]||(t.context[e]=t.setValue),t.context[e]+=t.setValue):t.context[e]=t.setValue),n},o}),kilo("FlowDefinition",["helper","obj","FlowObject"],function(t,n,e){"use strict";function r(t){var r=n.create(e);return r.init(t,1,!0)}return r}),kilo(["Func"],function(t){"use strict";return{greaterThan:t.fastPartial(function(t,n){return n>t}),lessThan:t.fastPartial(function(t,n){return t>n}),between:t.fastPartial(function(t,n,e){return e>t&&n>e}),greaterThanOrEqual:t.fastPartial(function(t,n){return n>=t}),lessThanOrEqual:t.fastPartial(function(t,n){return t>=n}),betweenInclusive:t.fastPartial(function(t,n,e){return e>=t&&n>=e}),outside:t.fastPartial(function(t,n,e){return t>e&&e>n}),and:t.fastPartial(function(){})}}),kilo("FlowObject",["Util","Obj","CommandRunner","CommandObject","Results"],function(t,n,e,r){"use strict";function o(t,n){return-1!==Object.keys(n).indexOf(t)}function i(n,e){Object.keys(n).forEach(function(r){t.isFunction(n[r])&&!o(r,c)&&(e.__savedFunctions||(e.__savedFunctions={}),e.__savedFunctions[r]=n[r],e[r]=u(e,n[r]))})}function u(t,n){return function(){return t.call(n)}}function s(t,n,e){return t[n].apply(t,e)}var c={after:function(t){return this.hookId=t,this},on:function(){return s(this.flow(),"on",arguments)},when:function(){return s(this.flow(),"when",arguments)},whenGroup:function(){return s(this.flow(),"whenGroup",arguments)},whenNot:function(){return s(this.flow(),"whenNot",arguments)},watch:function(){return s(this.flow(),"watch",arguments)},flow:function(t){return this.instance(this,t)},instance:function(t,o){var u=n.merge(r);return u.commandRunner=new e(t,o),i(t,u),u}};return c}),kilo("Flow",["Util","Obj","FlowObject"],function(t,n,e){"use strict";function r(t){return e.instance(t)}return r}),kilo.flowElement=function(t,n,e){"use strict";kilo(["Flow","Util"],function(r,o){var i,u;o.isFunction(n)?u=function(){n.apply(r(this),arguments)}:e&&(u=n,i=function(){e.apply(r(this),arguments)}),kilo.element(t,u,i)})},kilo("Results",["Util"],function(t){"use strict";return{add:function(n,e){this.sets=t.def(this.sets,[]),this.count=t.isDefined(this.count)?this.count+1:0,this.sets.push({commandRunners:e,sourceObjects:n,addCommand:function(n,e){var r=this.commandRunners;t.isDefined(e)&&e<r.length?r[e].add(n):r.forEach(function(t){t.add(n)})}})},get:function(t){return this.sets[t]},current:function(){return this.sets[this.count]},next:function(){return this.sets[this.count+1]},last:function(){return this.sets[this.count-1]}}}),function(){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),e=this,r=function(){},o=function(){return e.apply(this instanceof r&&t?this:t,n.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,o.prototype=new r,o})}();