var kilo=function(t){"use strict";function e(t){var e;"complete"===document.readyState?t():e=setInterval(function(){"complete"===document.readyState&&(t(),clearInterval(e))},10)}var n,r,o,i,u={},s={},c=void 0,a=t;return r={isDefined:function(t){return"undefined"!=typeof t},isBoolean:function(t){return"boolean"==typeof t},def:function(t,e){return"undefined"==typeof t?e:t},error:function(t){throw new Error(a+": "+t)},warn:function(t){r.log("Warning: "+t)},log:function(t){n.log&&console.log(a+": "+t)},argsToArray:function(t){return Array.prototype.slice.call(t)},getGID:function(t){return t=r.def(t,""),s[t]=r.def(s[t],0),t+ ++s[t]},rand:function(t,e){return e=e||0,(e>t||e>t)&&r.error("rand: invalid range."),Math.floor(Math.random()*(t-e+1))+e}},["Array","Object","Arguments","Function","String","Number","Date","RegExp","HTMLImageElement"].forEach(function(t){r["is"+t]=function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}),o={unresolved:{},modules:{},register:function(t,e,n,r){return this.unresolved[t]={deps:e,func:n,scope:r},this},unresolve:function(t){this.modules[t]&&delete this.modules[t]},setModule:function(t,e){return this.modules[t]=e,this},getDependency:function(t){var e=this.modules[t];return e?e:(e=this.unresolved[t])?(r.log("Resolving dependencies for '"+t+"'"),e=this.modules[t]=this.resolveAndApply(e.deps,e.func,e.scope),r.isObject(e)&&(e.getType=function(){return t}),e):(r.warn("Module '"+t+"' not found"),null)},resolve:function(t){var e,n,o,i=[];for(o=0;o<t.length;o++)n=t[o],e=this.getDependency(n),e?i.push(e):r.warn("Can't resolve "+n);return i},apply:function(t,e,r){return e.apply(r||n,t)},resolveAndApply:function(t,e,n){return this.apply(this.resolve(t),e,n)}},o.setModule("helper",r).setModule("Helper",r).setModule("Util",r).setModule("injector",o).setModule("Injector",o).setModule("appConfig",u),n=function(t,e,n,i){if(r.isArray(t))o.resolveAndApply(t,e,n);else if(r.isArray(e)&&r.isFunction(n))o.register(t,e,n,i);else if(r.isFunction(e))o.register(t,[],e,n);else if(t&&!r.isDefined(e))return o.getDependency(t);return null},n.unresolve=function(t){o.unresolve(t)},n.noConflict=function(){return window[t]=c,n},n.element=function(t,n,u){var s;return r.isFunction(n)?u=n:r.isArray(n)?s=n:r.error("element: second argument should be function or dependency array."),e(function(){var e,n,r,c;if(!i){if(n=document.getElementsByTagName("body"),!n||!n[0])return;i=n[0].querySelectorAll("*")}for(e=0,r=i.length;r>e;e++)c=i[e],(c.hasAttribute("data-"+t)||c.hasAttribute(t))&&(s?u.apply(c,o.resolve(s)):u.call(c))}),this},n.onDocumentReady=n.ready=e,n.log=!0,window[t]&&(r.warn("a preexisting value at namespace '"+t+"' has been overwritten."),c=window[t]),window[t]=n,n}("kilo");kilo("Canvas",[],function(){"use strict";return{clearContext:function(t,e,n){t.clearRect(0,0,e,n)},drawBackground:function(t,e,n,r,o,i){t.fillStyle=i||"red",t.fillRect(r||0,o||0,e,n)},drawBorder:function(t,e,n,r,o,i){t.beginPath(),t.strokeStyle=i||"black",t.rect(r||0,o||0,e,n),t.stroke(),t.closePath()}}}),kilo("Extend",["Obj"],function(t){"use strict";return t.extend.bind(t)}),kilo("Factory",["Obj","Pool"],function(t){"use strict";return function(e){var n=t.mixin([e]);return n}}),kilo("Func",[],function(){"use strict";function t(t){var e=Array.prototype.slice.call(arguments,1);return function(){for(var n=e.slice(),r=0;r<arguments.length;r++)n.push(arguments[r]);return t.apply(this,n)}}function e(e,n){return t(n,e)}return{partial:t,wrap:e}}),kilo("HashArray",[],function(){"use strict";function t(){this.values=[],this.keyMap={}}function e(t,e){var n;for(n in t)t.hasOwnProperty(n)&&t[n]>e&&t[n]--}function n(t,e){var n;for(n in t)t.hasOwnProperty(n)&&t[n]>=e&&t[n]++}return t.prototype.set=function(t,e){return this.keyMap[t]?(this.values[this.keyMap[t]]=e,!0):(this.values.push(e),this.keyMap[t]=this.values.length-1,!1)},t.prototype.splice=function(t,e,r){var o=this.keyMap[t]+1;this.values.splice(o,0,r),n(this.keyMap,o),this.keyMap[e]=o},t.prototype.get=function(t){return this.values[this.keyMap[t]]},t.prototype.remove=function(t){var n=this.keyMap[t];this.values.splice(n,1),e(this.keyMap,n),delete this.keyMap[t]},t.prototype.removeAll=function(){var t,e=this.keyMap;this.values.length=0;for(t in e)delete e[t]},t.prototype.getIdByIndex=function(t){var e,n=this.keyMap;for(e in n)if(n[e]===t)return e;return""},t.prototype.getKeys=function(){var t,e=this.size(),n=[];for(t=0;e>t;t++)n.push(this.getIdByIndex(t));return n},t.prototype.getValues=function(){return this.values},t.prototype.size=function(){return this.values.length},t}),kilo("KeyStore",["HashArray","Util"],function(t,e){"use strict";function n(){this.lastId=0,this.store=new t}return n.prototype.get=function(t){return this.store.get(t)},n.prototype.set=function(t,n){var r;return e.isDefined(n)?r=t||this.lastId++:(r=this.lastId++,n=t),this.store.add(r,n),r},n.prototype.setGroup=function(t,n){var r,o;return e.isDefined(n)?(r=t,e.isDefined(r)?o=this.get(r):(r=this.lastId++,o=[],this.store.add(r,o))):(r=this.lastId++,n=t,o=[],this.store.add(r,o)),o?o.push(n):console.error("Jack2d: keyStore: id '"+r+"' not found."),r},n.prototype.clear=function(t){e.isDefined(t)?this.store.remove(t):this.store.removeAll()},n.prototype.getItems=function(){return this.store.items},n}),kilo("Mixin",["Obj"],function(t){"use strict";return t.mixin.bind(t)}),kilo("Obj",["Injector","Util","Func","Pool"],function(t,e,n,r){"use strict";function o(t,r,o,i){return t=t||{},t.__mixin===!1?void e.error("Can't mixin object because the object has disallowed it."):void Object.keys(t).forEach(function(u){r.hasOwnProperty(u)?o?(r[u]=n.wrap(r[u],t[u]),e.log("Mixin: wrapped '"+u+"'")):i?e.error("Failed to merge mixin. Method '"+u+"' caused a name collision."):(r[u]=t[u],e.log("Mixin: overwrote '"+u+"'")):r[u]=t[u]})}function i(t,n){var r={};return Object.keys(t).forEach(function(o){e.isFunction(t[o])&&(r[o]=u(t[o],t,n))}),r}function u(t,n,r){return function(){var o=e.argsToArray(arguments);return r?(o.unshift(t),r.apply(n,o)):t.apply(n,o)}}return{replaceMethod:function(t,e,n,r){Object.keys(t).forEach(function(o){t[o]===e&&(console.log(r),t[o]=n)})},augment:function(t,e){return i(t,e)},clone:function(t){return this.merge(t)},merge:function(t,e){var n;e=e||{};for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},create:function(t){return this.mixin(t)},print:function(t){var n,r="";for(n in t)t.hasOwnProperty(n)&&!e.isFunction(t[n])&&(r+=n+": "+t[n]+"<br>");return r},clear:function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e];return t},extend:function(){var t=arguments.length>1?e.argsToArray(arguments):arguments[0];return this.mixin(t,!0)},mixin:function(n,i,u){var s=r.getObject();return e.isArray(n)?n.forEach(function(n){e.isString(n)&&(n=t.getDependency(n)),o(n,s,i,u)}):(e.isString(n)&&(n=t.getDependency(n)),o(n,s,i,u)),s}}}),kilo("Pool",[],function(){"use strict";function t(){var t=o.pop();return t||(t={}),t}function e(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e];return t}function n(t){o.push(e(t))}function r(){return o.length}var o=[];return{getObject:t,killObject:n,available:r}}),kilo("rect",[],function(){"use strict";function t(t,e,n){return!(t<n.left||t>n.right||e<n.top||e>n.bottom)}function e(t,e){return!(t.left<e.left||t.right>e.right||t.top<e.top||t.bottom>e.bottom)}function n(t,e){var n=!(t.left<e.left||t.right>e.right);return n?!1:t.left-e.left}function r(t,e){return!(t<e.left||t>e.right)}function o(t,e){var n=!(t.top<e.top||t.bottom>e.bottom);return n?!1:t.top-e.top}function i(t,e){return!(t<e.top||t>e.bottom)}function u(t,e){var n=!(e.left>=t.right||e.right<=t.left);return n?t.left-e.left:!1}function s(t,e){var n=!(e.top>=t.bottom||e.bottom<=t.top);return n?t.top-e.top:!1}return{setLeft:function(t){return this.left=t,this},setTop:function(t){return this.top=t,this},setRight:function(t){return this.right=t,this},setBottom:function(t){return this.bottom=t,this},containsPoint:t,containsRect:e,containsX:r,containsY:i,containsRectX:n,containsRectY:o,intersectsRectX:u,intersectsRectY:s}}),function(t){"use strict";var e,n=["ms","moz","webkit","o"];for(e=0;e<n.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"]||window[n[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){return window.setTimeout(e,t)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){window.clearTimeout(t)})}(62.5),kilo("SchedulerObject",["Util","Scheduler","Func"],function(t,e,n){"use strict";return{onFrame:function(n,r){var o=t.getGID(r);return this.chronoIds||(this.chronoIds=[]),this.hooks||(this.hooks={}),n=n.bind(this),r&&(this.hooks[r]=o),this.chronoIds.push(e.register(n,o)),this},getChronoId:function(t){return this.hooks?this.hooks[t]:null},hook:function(t,r){var o,i=this.getChronoId(t);i&&(o=e.getRegistered(i),o=n.wrap(o,r),e.register(o,i))},killOnFrame:function(t){return t?e.unRegister(t):this.chronoIds&&this.chronoIds.forEach(function(t){e.unRegister(t)}),this}}}),kilo("Scheduler",["HashArray","Util"],function(t,e){"use strict";function n(){return r(),l(),j}function r(){return w=60,k=0,b=0,F=0,I=0,O=0,A=new t,x=!1,P=new Date,j}function o(t,n){return e.isFunction(t)||e.error("Scheduler: only functions can be registered."),n||(n=e.getGID(n)),A.set(n,t),n}function i(t,e,n){return n||(n=I++),A.splice(t,n,e),n}function u(t){return A.remove(t),j}function s(t){return t?A.get(t):A.getValues()}function c(){M=window.requestAnimationFrame(f)}function a(){return A.size()}function l(){return x||(x=!0,C=window.setInterval(m,R),f()),j}function h(){return x=!1,window.clearInterval(C),window.cancelAnimationFrame(M),j}function f(){p(d()),g(),x&&c()}function p(t){var e,n,r,o;for(e=A.getValues(),n=e.length,o=0;n>o;o++)r=e[o],r&&r(t)}function d(){var t=+new Date,e=(t-P)/R;return P=t,e}function g(){b++}function m(){k=b.toString(),b=0,F++}function v(){return k}function y(){return F}var w,k,b,x,F,A,I,O,C,M,P,j,R=1e3;return n(),j={__mixin:!1,init:n,reset:r,start:l,stop:h,register:o,registerAfter:i,unRegister:u,getRegistered:s,registeredCount:a,getFps:v,getSeconds:y}}),kilo("CommandObject",["Util"],function(t){"use strict";function e(t,e,r){return n(t,{specialCondition:!0,logicMode:t.logicMode,type:e,value:r})}function n(t,e){return t.commandRunner.add(e),t}function r(){return n(this,{done:!0})}function o(t){var e=Array.prototype.slice.call(arguments,1);return n(this,{func:t,sourceAsArg:!0,args:e,context:this})}function i(t){return n(this,{watchProp:t,lastValue:null,logicals:[],specials:[]})}function u(t,e){return this.when(t,e,!0)}function s(){return n(this,{endGroup:!0})}function c(e,r,o){return n(this,{whenProp:e,whenValue:r,isFunc:t.isFunction(r),logicals:[],specials:[],commands:[],group:o})}function a(t){return e(this,"<",t)}function l(t){return e(this,"<=",t)}function h(t){return e(this,">",t)}function f(t){return e(this,">=",t)}function p(t){return e(this,"==",t)}function d(t){return this.when(t,!1)}function g(e,r){return n(this,{isLogical:!0,logicalProp:e,logicalValue:r,logicalType:"and",isFunc:t.isFunction(r),specials:[]})}function m(e,r){return n(this,{isLogical:!0,logicalProp:e,logicalValue:r,logicalType:"or",isFunc:t.isFunction(r),specials:[]})}function v(t,e,r,o){return n(this,{setProp:t,setValue:e,inc:r,format:o})}function y(t,e,n){return this.set(t,e,!0,n)}function w(t){return n(this,{eventName:t})}function k(t){var e=Array.prototype.slice.call(arguments,1);return n(this,{func:t,args:e})}return{commandRunner:null,or:null,and:null,logicMode:"",done:r,get:o,watch:i,whenGroup:u,endGroup:s,when:c,lessThan:a,lessThanOrEqualTo:l,greaterThan:h,greaterThanOrEqualTo:f,equalTo:p,whenNot:d,andWhen:g,orWhen:m,set:v,inc:y,on:w,call:k}}),kilo("CommandRunner",["Util","Scheduler"],function(t,e){"use strict";function n(t,e){function n(t,e){return t?2===e.length?t[e[0]]:n(t[e[0]],e.slice(1)):t}var r=e.split(".");return 1===r.length?t:n(t,r)}function r(t){return t.split(".").slice(-1)[0]}function o(t,e){this.chronoId=e,this.context=t,this.conditional=null,this.specialQueue=null}return o.prototype.add=function(t){t.setProp&&(t.context=n(this.context,t.setProp),t.setProp=r(t.setProp)),this.evaluateCommand(t)},o.prototype.evaluateCommand=function(t){if(t.whenProp||t.watchProp)this.specialQueue||(this.specialQueue=this.repeatQueue()),this.specialQueue.push(t);else if(t.eventName)this.specialQueue=this.eventQueue(t);else if(t.done)this.specialQueue=null;else{if(!this.specialQueue)return this.executeCommand(t);this.specialQueue.push(t)}return null},o.prototype.repeatQueue=function(){var n=[];return this.chronoId?e.registerAfter(this.chronoId,function(){this.processRepeatCommands(n)}.bind(this),t.getGID("command-repeat")):e.register(function(){this.processRepeatCommands(n)}.bind(this),t.getGID("command-repeat")),n},o.prototype.eventQueue=function(t){var e=[],n=this.context,r=this;return n.addEventListener&&n.addEventListener(t.eventName,function(){var t,n=e.length;for(t=0;n>t;t++)r.executeCommand(e[t])}),e},o.prototype.processRepeatCommands=function(t){var e,n,r=null,o=null,i=0;for(e=t.length;e>i;)n=t.shift(),n.group?o=n:n.endGroup?o=null:n.whenProp||n.watchProp?(r=n,r.logicals.length=0,r.specials.length=0):r&&n.isLogical?r.logicals.push(n):r&&n.specialCondition?r.logicals.length>0?r.logicals[r.logicals.length-1].specials.push(n):r.specials.push(n):o?this.evaluateConditional(o)&&r&&this.evaluateConditional(r)&&this.executeCommand(n):r&&this.evaluateConditional(r)&&this.executeCommand(n),t.push(n),i++},o.prototype.checkWatch=function(t){var e=this.context;return e[t.watchProp]!==t.lastValue?(t.lastValue=e[t.watchProp],!0):!1},o.prototype.evaluateConditional=function(e){var n=this.context;return e.isFunc&&e.whenValue(n[e.whenProp])||e.watchProp&&this.checkWatch(e,n)||e.whenProp&&!e.isFunc&&t.isDefined(n[e.whenProp])?!0:!1},o.prototype.evaluateLogical=function(e,n){var r,o,i,u,s=!1,c=this.context;for(u=0,r=e.length;r>u;u++){if(o=e[u],i=o.logicalType,n=o.logicalProp||n,o.isFunc)if(o.logicalValue(c[n])){if("and"!==i)return!0;s=!0}else s=!1;else if(t.isDefined(c[n])){if("and"!==i)return!0;s=!0}else s=!1;if(o.specials.length>0&&this.evaluateSpecials(o.specials,n)){if("and"!==i)return!0;s=!0}else s=!1}return s},o.prototype.evaluateSpecials=function(t,e){var n,r,o,i=!1,u=this.context;for(o=0,n=t.length;n>o;o++){if(r=t[o],"or"===r.logicMode&&i)return!0;switch(r.type){case"<":i=u[e]<r.value;break;case"<=":i=u[e]<=r.value;break;case">":i=u[e]>r.value;break;case">=":i=u[e]>=r.value;break;case"==":i=u[e]==r.value}}return i},o.prototype.executeCommand=function(t){var e,n,r,o=this.context;return t.complete?0===this.commandQueue.length?t.func.apply(t):e=t:t.eventName?o.addEventListener&&o.addEventListener(t.eventName,t.func):t.func?(t.sourceAsArg&&t.args.unshift(o),t.func.apply(t.context||o,t.args)):t.setProp&&(n=t.setProp,t.inc?"px"===t.format?t.context[n]?(r=t.context[n],t.context[n]=parseInt(r)+t.setValue+"px"):t.context[n]=t.setValue+"px":"%"===t.format?t.context[n]?(r=t.context[n],t.context[n]=parseInt(r)+t.setValue+"%"):t.context[n]=t.setValue+"%":(t.context[n]||(t.context[n]=t.setValue),t.context[n]+=t.setValue):t.context[n]=t.setValue),e},o}),kilo("FlowDefinition",["helper","obj","FlowObject"],function(t,e,n){"use strict";function r(t){var r=e.create(n);return r.init(t,1,!0)}return r}),kilo("FlowFunc",["Util"],function(t){"use strict";function e(t,e){return-1!==Object.keys(e).indexOf(t)}function n(){}return{attachCommandFunctions:function(r,o){Object.keys(r).forEach(function(i){t.isFunction(r[i])&&!e(i,FlowObject)&&(o.__savedFunctions||(o.__savedFunctions={}),o.__savedFunctions[i]=r[i],o[i]=n(i,r[i],o))})},attachCommandFunction:n}}),kilo("FlowObject",["Util","Obj","CommandRunner","CommandObject","Results"],function(t,e,n,r,o){"use strict";function i(t,e){return-1!==Object.keys(e).indexOf(t)}function u(e,n){Object.keys(e).forEach(function(r){t.isFunction(e[r])&&!i(r,f)&&(n.__savedFunctions||(n.__savedFunctions={}),n.__savedFunctions[r]=e[r],n[r]=s(n,e[r]))})}function s(t,e){return function(){return t.call(e)}}function c(e,n){var r,o=[];if(t.isArray(e))e.forEach(function(t){o.push(a(t))});else if(t.isString(e)&&n)for(r=0;n>r;r++)o.push(a(e));else o.push(a(e));return o}function a(n){return t.isString(n)?e.create(n):n}function l(t,e){var r,o=[];return t.forEach(function(t){r=new n(t,e),o.push(r)}),o}function h(t,e,n){return t[e].apply(t,n)}var f={after:function(t){return this.hookId=t,this},on:function(){return h(this.flow(),"on",arguments)},when:function(){return h(this.flow(),"when",arguments)},whenGroup:function(){return h(this.flow(),"whenGroup",arguments)},whenNot:function(){return h(this.flow(),"whenNot",arguments)},watch:function(){return h(this.flow(),"watch",arguments)},flow:function(t){var n,i,s=e.create(r),c=s.results=e.clone(o);return t=t||this.hookId,t&&this.getChronoId&&(i=this.getChronoId(t),s.hookId=t),s.sourceIndex=0,n=l([this],i),c.add([this],n),u(this,s),s},source:function(t,n,r,i){var s;return i=this.results=i||e.clone(o),this.sourceIndex=0,this.hookId=r,t=c(t,n),s=l(t,r),i.add(t,s),u(t[0],this),this},instance:function(t,o){var i=e.merge(r);return i.commandRunner=new n(t,o),u(t,i),i.or=e.clone(i),i.or.logicMode="or",i.and=e.clone(i),i.and.logicMode="and",i}};return f}),kilo("Flow",["Util","Obj","FlowObject"],function(t,e,n){"use strict";function r(t){return n.instance(t)}return r}),kilo("Results",["Util"],function(t){"use strict";return{add:function(e,n){this.sets=t.def(this.sets,[]),this.count=t.isDefined(this.count)?this.count+1:0,this.sets.push({commandRunners:n,sourceObjects:e,addCommand:function(e,n){var r=this.commandRunners;t.isDefined(n)&&n<r.length?r[n].add(e):r.forEach(function(t){t.add(e)})}})},get:function(t){return this.sets[t]},current:function(){return this.sets[this.count]},next:function(){return this.sets[this.count+1]},last:function(){return this.sets[this.count-1]}}});